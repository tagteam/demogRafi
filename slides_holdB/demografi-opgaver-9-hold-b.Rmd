---
title: 'Demografi: opgaver 9'
format: 
  revealjs:
    # theme: theme.scss
    transition: slide
    embed-resources: true
# background-image: 4ccc.jpg
background-size: contain
background-opacity: "0.8"
editor: visual
---

```{r setup}
knitr::opts_knit$set(root.dir = "..")
source("https://raw.githubusercontent.com/tagteam/demogRafi/main/R-scripts/demofunk.R")
## set cache = TRUE
knitr::opts_chunk$set(echo=TRUE)#cache = TRUE 
```

## Opgave 1 {style="font-size: 78%;"}

Hent data fra statistikbankens register RAS300 som ligger under â€˜Arbejde
og indkomstâ€™. For Ã¥rene 2009 og 2019: find det totale antal beskÃ¦ftigede
mÃ¦nd i Danmark og antal mÃ¦nd, som arbejdede i branchen â€˜85002 Gymnasier
og erhvervsfaglige skolerâ€™ i aldersintervaller, hvor det fÃ¸rste interval
er â€˜Under 16 Ã¥râ€™ og det sidste â€˜67 Ã¥r og deroverâ€™.

Beregn for begge Ã¥rstal aldersspecifikke andele af mÃ¦nd i branchen
â€˜85002 Gymnasier og erhvervsfaglige skolerâ€™ blandt beskÃ¦ftigede mÃ¦nd, og
udfyld tabellen nedenfor.

Beregn og rapporter hvor mange ud af 1000 beskÃ¦ftigede mÃ¦nd, der har
arbejdet i branchen â€˜85002 Gymnasier og erhvervsfaglige skolerâ€™ i Ã¥rene
2009 og 2019. Diskuter tidsudviklingen i branchen â€˜85002 Gymnasier og
erhvervsfaglige skolerâ€™.

## Aldersspecifikke beskÃ¦ftigelsesrater

```{r}
## hent data
arb_dat <- hent_data("RAS300", 
                     branche07=c(85002,"TOT"),
                     alder = "all", 
                     tid = c("2009","2019"), 
                     kÃ¸n = "mÃ¦nd") %>% 
  mutate(BRANCHE07 = fct_recode(BRANCHE07,
                                "Branche" = "85002 Gymnasier og erhvervsfaglige skoler", 
                                "BeskÃ¦ftigede" = "TOT Erhverv i alt"),
         "Alder" = ALDER)

table_opg_1 <- arb_dat %>%
  pivot_wider(names_from = c(BRANCHE07, TID), 
              values_from = "INDHOLD") %>%
  mutate(Andel_2009 = Branche_2009/BeskÃ¦ftigede_2009, 
         Andel_2019 = Branche_2019/BeskÃ¦ftigede_2019) %>%
  select(Alder,
         BeskÃ¦ftigede_2009, 
         BeskÃ¦ftigede_2019, 
         Branche_2009,
         Branche_2019, 
         Andel_2009, 
         Andel_2019) 
```

## Eksempelbrug med eksport fra **R** til **Word**

## Brug af **gt**-pakken

```{r}
## I skal kÃ¸re nedenstÃ¥ende linje uden hashtags, hvis I fÃ¥r fejlen 'Error in library("gt") : there is no package called â€˜gtâ€™'
## install.packages("gt") 
library(gt) 
res_table_opg_1 <- table_opg_1 %>%
  gt() %>%
  fmt_number(columns = c("BeskÃ¦ftigede_2009", "BeskÃ¦ftigede_2019", "Branche_2009", "Branche_2019"),
             decimals = 0, locale = "da") %>% ## Antal personer skal vÃ¦re angivet i HELE tal; bruug dansk formatering
  fmt_number(columns = c("Andel_2009", "Andel_2019"), 
             decimals = 3, locale = "da") ## Andel angivet som kommatal med to decimaler; brug dansk formatering
```

## Tabel

```{r, echo = FALSE}
res_table_opg_1
```


## Trin 1: Marker tabel

![](klip1.png)

::: {.incremental}
-   Brug Ctrl + C for at kopiere tabellen eller hÃ¸jreklik og vÃ¦lg
    **Copy**.
-   Markeringen kan let laves ved at hÃ¸jreklikke pÃ¥ tabellen og vÃ¦lge
    **Select All** (hvis tabellen vises i panelet).
:::

## Trin 2: SÃ¦t ind i **docx**-filen for jeres besvarelse {style="font-size: 80%;"}

![](klip2.png)

::: {.incremental}
-   Brug Ctrl + V for at indsÃ¦tte tabellen i et
    Word/tekstredigeringsprogram.
:::

## Hvis ikke kopieringen giver jer en tabel i Word

```{r,eval=FALSE}
res_table_opg_1 %>% gtsave("min_tabel.docx")
```

::: {.incremental}
- Ã…bn filen **min_tabel.docx** i Word.
:::

## Trin 3: UdvÃ¦lg rÃ¦kker til opgavens tabel

::: {.incremental}
-   Da I ikke mÃ¥ indsÃ¦tte jeres egen tabel skal I udvÃ¦lge de rÃ¦kker og
    sÃ¸jler, I vil bruge og kopiere dem ind i tabellen i Word.
-   Marker sÃ¸jlerne og rÃ¦kkerne der er relevante for opgavens tabel og kopier dem.
:::

## Billede til Trin 3

![](klip3.png)

## Trin 4: SÃ¦t ind i tabellen til besvarelsen.

![](klip4.png)
::: {.incremental}
-   Brug Ctrl + V for at indsÃ¦tte tabellen i Word i den viste celle.
:::

## Resultat

![](klip5.png)


## Alternativer

-   Brug **writexl**-pakken, Ã¥bn filen **table_opg_1.xlsx** i Excel, 
    udvÃ¦lg de relevante rÃ¦kker og sÃ¸jler og kopier. 

```{r, eval = FALSE}
## I skal kÃ¸re nedenstÃ¥ende linje uden hashtags, hvis I fÃ¥r fejlen 'Error in library("writexl") : there is no package called â€˜writexlâ€™'
## install.packages("writexl") 
library(writexl) 
write_xlsx(as.data.frame(res_table_opg_1), "table_opg_1.xlsx") ## filen gemmes i samme mappe som .Rmd-filen
```

::: {.incremental}
-   Kan ogsÃ¥ **knitte** jeres dokumentet og sÃ¥ kopiere den relevante del af tabellen ind. Dette krÃ¦ver dog, at alt jeres kode kan kÃ¸res uden fejl.
-   Som sidste udvej er det ogsÃ¥ tilladt at taste manuelt ind ğŸ¥±.
:::

## Anden delopgave

```{r}
table_opg_1 %>% 
  summarise("Summarisk beskÃ¦ftigelsesrate (2009)" = sum(Branche_2009)/sum(BeskÃ¦ftigede_2009)*1000, 
            "Summarisk beskÃ¦ftigelsesrate (2019)" = sum(Branche_2019)/sum(BeskÃ¦ftigede_2019)*1000) %>%
  gt() %>%
  fmt_number(columns = c("Summarisk beskÃ¦ftigelsesrate (2009)", "Summarisk beskÃ¦ftigelsesrate (2019)"), 
             decimals = 1, locale = "da")
```

## Kommentarer

::: {.incremental}
- Der har vÃ¦ret et fald pÃ¥ 1,5 mÃ¦nd pr. 1000 beskÃ¦ftigede mÃ¦nd i branchen "Gymnasier og erhvervsfaglige skoler" i lÃ¸bet af perioden fra 2009 til 2019.
- Faldet kan mÃ¥ske skyldes, at de 50-66 Ã¥rige er gÃ¥et pÃ¥ pension i 2019 og at antallet af mÃ¦nd i alderen 16-44 Ã¥r har kun Ã¦ndret sig minimalt fra 2009 til 2019.
- Husk at rapportere jeres resultater i hele sÃ¦tninger! Den vejledende besvarelse, der kommer op er god inspiration til, hvordan I kan formulere jeres besvarelse.
:::

## Besvarelse {style="font-size: 85%;"}

De specifikke andele for forskellige aldersgrupper i tabellen viser antallet af mÃ¦nd pr. 1000 beskÃ¦ftigede mÃ¦nd i branchen Gymnasier og erhvervsfaglige skoler. I 2009 arbejdede 16,7 mÃ¦nd i denne branche ud af hver 1000 beskÃ¦ftigede mÃ¦nd, mens tallet faldt til 15,2 i 2019. Der har sÃ¥ledes vÃ¦ret en nedgang pÃ¥ 1,5 mÃ¦nd pr. 1000 beskÃ¦ftigede mÃ¦nd i lÃ¸bet af perioden fra 2009 til 2019. Det bemÃ¦rkes i tabellen, at mÃ¦nd i alderen 50-66 udgjorde en betydelig del af arbejdsstyrken i 2009. Det kan antages, at den faldende beskÃ¦ftigelsesrate delvist skyldes, at nogle af disse mÃ¦nd er gÃ¥et pÃ¥ pension. Antallet af mÃ¦nd i alderen 16-44 Ã¥r har kun Ã¦ndret sig minimalt fra 2009 til 2019, hvilket indikerer, at der ikke er kommet tilsvarende flere mÃ¦nd til i 2019 sammenlignet med 2009. Dette bidrager til nedgangen i andelen af mÃ¦nd, der arbejder inden for branchen Gymnasier og erhvervsfaglige skoler. 

## Opgave 2 {style="font-size: 86%;"}

Hent data fra statistikbankens register RAS300, som ligger under
'Arbejde og indkomst' og fra register FOLK1a, som ligger under
'Borgere'. For Ã¥ret 2009: find det totale antal beskÃ¦ftigede mÃ¦nd i
Danmark i aldersintervaller, hvor det fÃ¸rste interval er 'Under 16 Ã¥r'
og det sidste '67 Ã¥r og derover'. For samme aldersintervaller find
risikotid for alle mÃ¦nd i Danmark i 2009 og 2019 og beregn
aldersfordelingen af risikotid i begge Ã¥r. Beregn aldersspecifikke
beskÃ¦ftigelsesrater for mÃ¦nd i Ã¥ret 2009 og udfyld tabellen nedenfor.
For mÃ¦nd i Ã¥ret 2009: beregn og rapporter summariske og
alderstandardiserede beskÃ¦ftigelsesrater med aldersfordeling fra mÃ¦nd i
Ã¥ret 2019 som standardpopulation. Diskuter forskellen mellem den
summariske og den aldersstandardiserede beskÃ¦ftigelsesrate.

## R-kode til tabel

```{r}
beskaeft <- arb_dat %>%
  filter(BRANCHE07 == "BeskÃ¦ftigede", 
         TID == "2009") %>%
  pivot_wider(names_from = c(BRANCHE07, TID), 
              values_from = "INDHOLD") %>% 
  select(-c("KÃ˜N", "alder","ALDER")) 

R <- hent_aldersfordeling(breaks = c(0,15,seq(19,64,5),66,Inf),  
                          tid = c("2009","2019"), 
                          kÃ¸n = "mÃ¦nd") %>%
  rename(Risikotid = R, 
         Aldersfordeling = V)  %>% 
  pivot_wider(names_from = TID, 
              values_from = c("Risikotid", "Aldersfordeling")) %>% 
  select(-c("KÃ˜N", "OMRÃ…DE", "aldersinterval")) 

table_opg_2 <- cbind(beskaeft, R) %>% 
  mutate(BeskÃ¦ftigelsesrate = BeskÃ¦ftigede_2009/Risikotid_2009)
```

## Tabel {style="font-size: 60%;"}

```{r}
table_opg_2 %>% 
  gt() %>%
  fmt_number(columns = c("BeskÃ¦ftigede_2009", "Risikotid_2009", "Risikotid_2019"), 
             decimals = 0, locale = "da") %>%
  fmt_number(columns = c("Aldersfordeling_2009", "Aldersfordeling_2019", "BeskÃ¦ftigelsesrate"), 
             decimals = 3, locale = "da")
```

## Summarisk og standardiseret beskÃ¦ftigelsesrate

```{r}
table_opg_2 %>% summarize("Summarisk beskÃ¦ftigelsesrate" = sum(BeskÃ¦ftigede_2009)/sum(Risikotid_2009)*1000, 
                          "Standardiseret beskÃ¦ftigelsesrate" = sum(BeskÃ¦ftigelsesrate * Aldersfordeling_2019)*1000) %>%
  gt() %>%
  fmt_number(columns = c("Summarisk beskÃ¦ftigelsesrate", "Standardiseret beskÃ¦ftigelsesrate"), 
             decimals = 1, locale = "da")
```

## Kommentarer

::: {.incremental}
- Risikotiden er beregnet ved hjÃ¦lp af standardmetode 2 (trapez) (oplysninger om befolkningstal fra K12009, K12010, K12019 og K12020).
- Rapporter beskÃ¦ftigelsesraterne og fortolk den aldersstandidiserede beskÃ¦ftigelsesrate. 
- Forskellen mellem den samlede og den aldersstandardiserede
beskÃ¦ftigelsesrate skyldes sandsynligvis Ã¦ndringer i befolkningens
alderssammensÃ¦tning mellem 2009 og 2019. Forskellen afspejler det aldrende samfund.
:::

## Besvarelse {style="font-size: 68%;"}

Risikotiden er beregnet ved hjÃ¦lp af standardmetode 2 (trapez) og oplysninger om befolkningstal fra K12009, K12010, K12019 og K12020. Aldersfordelingen er angivet i procent. BeskÃ¦ftigelsesraten mÃ¥les som antallet af beskÃ¦ftigede mÃ¦nd pr. 1000 mÃ¦nd i Danmark. 
I 2009 blev den samlede beskÃ¦ftigelsesrate for mÃ¦nd beregnet til 515,6 beskÃ¦ftigede mÃ¦nd pr. 1000 mÃ¦nd i Danmark. Den aldersstandardiserede beskÃ¦ftigelsesrate for mÃ¦nd i 2009 blev beregnet til 504,3 beskÃ¦ftigede mÃ¦nd pr. 1000 mÃ¦nd i Danmark. Den aldersstandardiserede beskÃ¦ftigelsesrate giver et udtryk for, hvordan den samlede beskÃ¦ftigelsesrate i 2009 ville have vÃ¦ret, hvis aldersfordelingen i befolkningen havde vÃ¦ret som i 2019.

Forskellen mellem den samlede og den aldersstandardiserede beskÃ¦ftigelsesrate skyldes sandsynligvis Ã¦ndringer i befolkningens alderssammensÃ¦tning mellem 2009 og 2019. Som det fremgÃ¥r af tabellen, udgÃ¸r Ã¦ldre over 67 Ã¥r en stÃ¸rre del af befolkningen i 2019 sammenlignet med 2009. Samtidig udgÃ¸r mÃ¦ndene med de hÃ¸jeste beskÃ¦ftigelsesrater, dvs. mÃ¦nd mellem 30 og 54 Ã¥r, en mindre del af befolkningen i 2019 sammenlignet med 2009. Forskellen afspejler derfor det aldrende samfund, hvor Ã¦ldre udgÃ¸r en relativt stÃ¸rre del af befolkningen. 

## Opgave 3 {style="font-size: 80%;"}

I arbejdsmarkedsdemografien beregner man forventet levetid pÃ¥
arbejdsmarkedet, som er en parallel til middellevetiden, hvor man tager
hÃ¸jde for den aldersspecifikke afgang fra arbejdsmarkedet.

a.  Aldersfordelingen for kvinder og mÃ¦nd i Danmark er forskellig, bl.a.
    pÃ¥ grund af kÃ¸nsforskelle i immigration og dÃ¸delighed. Kan forskelle
    i aldersfordelingen mellem mÃ¦nd og kvinder pÃ¥virke forskellen i
    forventet levetid pÃ¥ arbejdsmarkedet?
b.  Hvis man skulle beregne en forventet levetid pÃ¥ arbejdsmarkedet,
    hvilke data og antagelser skulle man sÃ¥ bruge?

## Besvarelse a)

Forventet levetid pÃ¥ arbejdsmarkedet kan pÃ¥virkes af forskelle i aldersfordelingen mellem mÃ¦nd og kvinder under visse omstÃ¦ndigheder: 1) Hvis man beregner den forventede levetid pÃ¥ arbejdsmarkedet uden hensyntagen til kÃ¸n, og 2) hvis der er forskel i levetiden pÃ¥ arbejdsmarkedet mellem mÃ¦nd og kvinder. Hvis man derimod beregner den forventede levetid pÃ¥ arbejdsmarkedet separat for hvert kÃ¸n, burde forskelle i aldersfordelingen ikke have indflydelse pÃ¥ den forventede levetid pÃ¥ arbejdsmarkedet. 

## Besvarelse b) {style="font-size: 80%;"}

Med udgangspunkt i beregningen af en dÃ¸delighedstabel kan man beregne den forventede restlevetid pÃ¥ arbejdsmarkedet svarende til den forventede restlevetid i en dÃ¸delighedstabel ved hjÃ¦lp af fÃ¸lgende data og antagelser: I en fiktiv befolkning antages det fÃ¸rst, at alle trÃ¦der ind pÃ¥ arbejdsmarkedet samtidig, og at ingen forlader arbejdsmarkedet i kortere perioder fÃ¸r deres endelige exit. Man skal have data om, hvor mange der forlader arbejdsmarkedet i hvert alderstrin eller aldersinterval i en given periode i en faktisk befolkning. Kun personer, der definitivt har forladt arbejdsmarkedet, bÃ¸r medtages. Der mÃ¥ derfor gÃ¸res antagelser om, hvornÃ¥r en person kan siges at have forladt arbejdsmarkedet uden hensigt om at vende tilbage, eventuelt baseret pÃ¥ oplysninger om tilbagevenden til arbejdsmarkedet eller Ã¥rsagen til exit. Endelig mÃ¥ man antage, hvornÃ¥r i lÃ¸bet af Ã¥ret eller i et aldersinterval en person forlader arbejdsmarkedet, det vil sige, man skal definere Chiangs a for hvert alderstrin eller aldersinterval.