---
title: 'Demografi: opgaver 9'
format: 
  revealjs:
    # theme: theme.scss
    transition: slide
    embed-resources: true
# background-image: 4ccc.jpg
background-size: contain
background-opacity: "0.8"
editor: visual
---

```{r setup}
knitr::opts_knit$set(root.dir = "..")
source("https://raw.githubusercontent.com/tagteam/demogRafi/main/R-scripts/demofunk.R")
## set cache = TRUE
knitr::opts_chunk$set(echo=TRUE)#cache = TRUE 
```

## Opgave 1 {style="font-size: 78%;"}

Hent data fra statistikbankens register RAS300 som ligger under ‚ÄòArbejde
og indkomst‚Äô. For √•rene 2009 og 2019: find det totale antal besk√¶ftigede
m√¶nd i Danmark og antal m√¶nd, som arbejdede i branchen ‚Äò85002 Gymnasier
og erhvervsfaglige skoler‚Äô i aldersintervaller, hvor det f√∏rste interval
er ‚ÄòUnder 16 √•r‚Äô og det sidste ‚Äò67 √•r og derover‚Äô.

Beregn for begge √•rstal aldersspecifikke andele af m√¶nd i branchen
‚Äò85002 Gymnasier og erhvervsfaglige skoler‚Äô blandt besk√¶ftigede m√¶nd, og
udfyld tabellen nedenfor.

Beregn og rapporter hvor mange ud af 1000 besk√¶ftigede m√¶nd, der har
arbejdet i branchen ‚Äò85002 Gymnasier og erhvervsfaglige skoler‚Äô i √•rene
2009 og 2019. Diskuter tidsudviklingen i branchen ‚Äò85002 Gymnasier og
erhvervsfaglige skoler‚Äô.

## Aldersspecifikke besk√¶ftigelsesrater

```{r}
## hent data
arb_dat <- hent_data("RAS300", 
                     branche07=c(85002,"TOT"),
                     alder = "all", 
                     tid = c("2009","2019"), 
                     k√∏n = "m√¶nd") %>% 
  mutate(BRANCHE07 = fct_recode(BRANCHE07,
                                "Branche" = "85002 Gymnasier og erhvervsfaglige skoler", 
                                "Besk√¶ftigede" = "TOT Erhverv i alt"),
         "Alder" = ALDER)

table_opg_1 <- arb_dat %>%
  pivot_wider(names_from = c(BRANCHE07, TID), 
              values_from = "INDHOLD") %>%
  mutate(Andel_2009 = Branche_2009/Besk√¶ftigede_2009, 
         Andel_2019 = Branche_2019/Besk√¶ftigede_2019) %>%
  select(Alder,
         Besk√¶ftigede_2009, 
         Besk√¶ftigede_2019, 
         Branche_2009,
         Branche_2019, 
         Andel_2009, 
         Andel_2019) 
```

## Eksempelbrug med eksport fra **R** til **Word**

## Brug af **gt**-pakken

```{r}
## I skal k√∏re nedenst√•ende linje uden hashtags, hvis I f√•r fejlen 'Error in library("gt") : there is no package called ‚Äògt‚Äô'
## install.packages("gt") 
library(gt) 
res_table_opg_1 <- table_opg_1 %>%
  gt() %>%
  fmt_number(columns = c("Besk√¶ftigede_2009", "Besk√¶ftigede_2019", "Branche_2009", "Branche_2019"),
             decimals = 0, locale = "da") %>% ## Antal personer skal v√¶re angivet i HELE tal; bruug dansk formatering
  fmt_number(columns = c("Andel_2009", "Andel_2019"), 
             decimals = 3, locale = "da") ## Andel angivet som kommatal med to decimaler; brug dansk formatering
```

## Tabel

```{r, echo = FALSE}
res_table_opg_1
```


## Trin 1: Marker tabel

![](klip1.png)

::: {.incremental}
-   Brug Ctrl + C for at kopiere tabellen eller h√∏jreklik og v√¶lg
    **Copy**.
-   Markeringen kan let laves ved at h√∏jreklikke p√• tabellen og v√¶lge
    **Select All** (hvis tabellen vises i panelet).
:::

## Trin 2: S√¶t ind i **docx**-filen for jeres besvarelse {style="font-size: 80%;"}

![](klip2.png)

::: {.incremental}
-   Brug Ctrl + V for at inds√¶tte tabellen i et
    Word/tekstredigeringsprogram.
:::

## Hvis ikke kopieringen giver jer en tabel i Word

```{r,eval=FALSE}
res_table_opg_1 %>% gtsave("min_tabel.docx")
```

::: {.incremental}
- √Öbn filen **min_tabel.docx** i Word.
:::

## Trin 3: Udv√¶lg r√¶kker til opgavens tabel

::: {.incremental}
-   Da I ikke m√• inds√¶tte jeres egen tabel skal I udv√¶lge de r√¶kker og
    s√∏jler, I vil bruge og kopiere dem ind i tabellen i Word.
-   Marker s√∏jlerne og r√¶kkerne der er relevante for opgavens tabel og kopier dem.
:::

## Billede til Trin 3

![](klip3.png)

## Trin 4: S√¶t ind i tabellen til besvarelsen.

![](klip4.png)
::: {.incremental}
-   Brug Ctrl + V for at inds√¶tte tabellen i Word i den viste celle.
:::

## Resultat

![](klip5.png)


## Alternativer

-   Brug **writexl**-pakken, √•bn filen **table_opg_1.xlsx** i Excel, 
    udv√¶lg de relevante r√¶kker og s√∏jler og kopier. 

```{r, eval = FALSE}
## I skal k√∏re nedenst√•ende linje uden hashtags, hvis I f√•r fejlen 'Error in library("writexl") : there is no package called ‚Äòwritexl‚Äô'
## install.packages("writexl") 
library(writexl) 
write_xlsx(as.data.frame(res_table_opg_1), "table_opg_1.xlsx") ## filen gemmes i samme mappe som .Rmd-filen
```

::: {.incremental}
-   Kan ogs√• **knitte** jeres dokumentet og s√• kopiere den relevante del af tabellen ind. Dette kr√¶ver dog, at alt jeres kode kan k√∏res uden fejl.
-   Som sidste udvej er det ogs√• tilladt at taste manuelt ind ü•±.
:::

## Anden delopgave

```{r}
table_opg_1 %>% 
  summarise("Summarisk besk√¶ftigelsesrate (2009)" = sum(Branche_2009)/sum(Besk√¶ftigede_2009)*1000, 
            "Summarisk besk√¶ftigelsesrate (2019)" = sum(Branche_2019)/sum(Besk√¶ftigede_2019)*1000) %>%
  gt() %>%
  fmt_number(columns = c("Summarisk besk√¶ftigelsesrate (2009)", "Summarisk besk√¶ftigelsesrate (2019)"), 
             decimals = 1, locale = "da")
```

## Kommentarer

::: {.incremental}
- Der har v√¶ret et fald p√• 1,5 m√¶nd pr. 1000 besk√¶ftigede m√¶nd i branchen "Gymnasier og erhvervsfaglige skoler" i l√∏bet af perioden fra 2009 til 2019.
- Faldet kan m√•ske skyldes, at de 50-66 √•rige er g√•et p√• pension i 2019 og at antallet af m√¶nd i alderen 16-44 √•r har kun √¶ndret sig minimalt fra 2009 til 2019.
- Husk at rapportere jeres resultater i hele s√¶tninger! Den vejledende besvarelse, der kommer op er god inspiration til, hvordan I kan formulere jeres besvarelse.
:::

## Besvarelse {style="font-size: 85%;"}

De specifikke andele for forskellige aldersgrupper i tabellen viser antallet af m√¶nd pr. 1000 besk√¶ftigede m√¶nd i branchen Gymnasier og erhvervsfaglige skoler. I 2009 arbejdede 16,7 m√¶nd i denne branche ud af hver 1000 besk√¶ftigede m√¶nd, mens tallet faldt til 15,2 i 2019. Der har s√•ledes v√¶ret en nedgang p√• 1,5 m√¶nd pr. 1000 besk√¶ftigede m√¶nd i l√∏bet af perioden fra 2009 til 2019. Det bem√¶rkes i tabellen, at m√¶nd i alderen 50-66 udgjorde en betydelig del af arbejdsstyrken i 2009. Det kan antages, at den faldende besk√¶ftigelsesrate delvist skyldes, at nogle af disse m√¶nd er g√•et p√• pension. Antallet af m√¶nd i alderen 16-44 √•r har kun √¶ndret sig minimalt fra 2009 til 2019, hvilket indikerer, at der ikke er kommet tilsvarende flere m√¶nd til i 2019 sammenlignet med 2009. Dette bidrager til nedgangen i andelen af m√¶nd, der arbejder inden for branchen Gymnasier og erhvervsfaglige skoler. 

## Opgave 2 {style="font-size: 86%;"}

Hent data fra statistikbankens register RAS300, som ligger under
'Arbejde og indkomst' og fra register FOLK1a, som ligger under
'Borgere'. For √•ret 2009: find det totale antal besk√¶ftigede m√¶nd i
Danmark i aldersintervaller, hvor det f√∏rste interval er 'Under 16 √•r'
og det sidste '67 √•r og derover'. For samme aldersintervaller find
risikotid for alle m√¶nd i Danmark i 2009 og 2019 og beregn
aldersfordelingen af risikotid i begge √•r. Beregn aldersspecifikke
besk√¶ftigelsesrater for m√¶nd i √•ret 2009 og udfyld tabellen nedenfor.
For m√¶nd i √•ret 2009: beregn og rapporter summariske og
alderstandardiserede besk√¶ftigelsesrater med aldersfordeling fra m√¶nd i
√•ret 2019 som standardpopulation. Diskuter forskellen mellem den
summariske og den aldersstandardiserede besk√¶ftigelsesrate.

## R-kode til tabel

```{r}
beskaeft <- arb_dat %>%
  filter(BRANCHE07 == "Besk√¶ftigede", 
         TID == "2009") %>%
  pivot_wider(names_from = c(BRANCHE07, TID), 
              values_from = "INDHOLD") %>% 
  select(-c("K√òN", "alder","ALDER")) 

R <- hent_aldersfordeling(breaks = c(0,15,seq(19,64,5),66,Inf),  
                          tid = c("2009","2019"), 
                          k√∏n = "m√¶nd") %>%
  rename(Risikotid = R, 
         Aldersfordeling = V)  %>% 
  pivot_wider(names_from = TID, 
              values_from = c("Risikotid", "Aldersfordeling")) %>% 
  select(-c("K√òN", "OMR√ÖDE", "aldersinterval")) 

table_opg_2 <- cbind(beskaeft, R) %>% 
  mutate(Besk√¶ftigelsesrate = Besk√¶ftigede_2009/Risikotid_2009)
```

## Tabel {style="font-size: 60%;"}

```{r}
table_opg_2 %>% 
  gt() %>%
  fmt_number(columns = c("Besk√¶ftigede_2009", "Risikotid_2009", "Risikotid_2019"), 
             decimals = 0, locale = "da") %>%
  fmt_number(columns = c("Aldersfordeling_2009", "Aldersfordeling_2019", "Besk√¶ftigelsesrate"), 
             decimals = 3, locale = "da")
```

## Summarisk og standardiseret besk√¶ftigelsesrate

```{r}
table_opg_2 %>% summarize("Summarisk besk√¶ftigelsesrate" = sum(Besk√¶ftigede_2009)/sum(Risikotid_2009)*1000, 
                          "Standardiseret besk√¶ftigelsesrate" = sum(Besk√¶ftigelsesrate * Aldersfordeling_2019)*1000) %>%
  gt() %>%
  fmt_number(columns = c("Summarisk besk√¶ftigelsesrate", "Standardiseret besk√¶ftigelsesrate"), 
             decimals = 1, locale = "da")
```

## Kommentarer

::: {.incremental}
- Risikotiden er beregnet ved hj√¶lp af standardmetode 2 (trapez) (oplysninger om befolkningstal fra K12009, K12010, K12019 og K12020).
- Rapporter besk√¶ftigelsesraterne og fortolk den aldersstandidiserede besk√¶ftigelsesrate. 
- Forskellen mellem den samlede og den aldersstandardiserede
besk√¶ftigelsesrate skyldes sandsynligvis √¶ndringer i befolkningens
alderssammens√¶tning mellem 2009 og 2019. Forskellen afspejler det aldrende samfund.
:::

## Besvarelse {style="font-size: 68%;"}

Risikotiden er beregnet ved hj√¶lp af standardmetode 2 (trapez) og oplysninger om befolkningstal fra K12009, K12010, K12019 og K12020. Aldersfordelingen er angivet i procent. Besk√¶ftigelsesraten m√•les som antallet af besk√¶ftigede m√¶nd pr. 1000 m√¶nd i Danmark. 
I 2009 blev den samlede besk√¶ftigelsesrate for m√¶nd beregnet til 515,6 besk√¶ftigede m√¶nd pr. 1000 m√¶nd i Danmark. Den aldersstandardiserede besk√¶ftigelsesrate for m√¶nd i 2009 blev beregnet til 504,3 besk√¶ftigede m√¶nd pr. 1000 m√¶nd i Danmark. Den aldersstandardiserede besk√¶ftigelsesrate giver et udtryk for, hvordan den samlede besk√¶ftigelsesrate i 2009 ville have v√¶ret, hvis aldersfordelingen i befolkningen havde v√¶ret som i 2019.

Forskellen mellem den samlede og den aldersstandardiserede besk√¶ftigelsesrate skyldes sandsynligvis √¶ndringer i befolkningens alderssammens√¶tning mellem 2009 og 2019. Som det fremg√•r af tabellen, udg√∏r √¶ldre over 67 √•r en st√∏rre del af befolkningen i 2019 sammenlignet med 2009. Samtidig udg√∏r m√¶ndene med de h√∏jeste besk√¶ftigelsesrater, dvs. m√¶nd mellem 30 og 54 √•r, en mindre del af befolkningen i 2019 sammenlignet med 2009. Forskellen afspejler derfor det aldrende samfund, hvor √¶ldre udg√∏r en relativt st√∏rre del af befolkningen. 

## Opgave 3 {style="font-size: 80%;"}

I arbejdsmarkedsdemografien beregner man forventet levetid p√•
arbejdsmarkedet, som er en parallel til middellevetiden, hvor man tager
h√∏jde for den aldersspecifikke afgang fra arbejdsmarkedet.

a.  Aldersfordelingen for kvinder og m√¶nd i Danmark er forskellig, bl.a.
    p√• grund af k√∏nsforskelle i immigration og d√∏delighed. Kan forskelle
    i aldersfordelingen mellem m√¶nd og kvinder p√•virke forskellen i
    forventet levetid p√• arbejdsmarkedet?
b.  Hvis man skulle beregne en forventet levetid p√• arbejdsmarkedet,
    hvilke data og antagelser skulle man s√• bruge?

## Besvarelse a)

Forventet levetid p√• arbejdsmarkedet kan p√•virkes af forskelle i aldersfordelingen mellem m√¶nd og kvinder under visse omst√¶ndigheder: 1) Hvis man beregner den forventede levetid p√• arbejdsmarkedet uden hensyntagen til k√∏n, og 2) hvis der er forskel i levetiden p√• arbejdsmarkedet mellem m√¶nd og kvinder. Hvis man derimod beregner den forventede levetid p√• arbejdsmarkedet separat for hvert k√∏n, burde forskelle i aldersfordelingen ikke have indflydelse p√• den forventede levetid p√• arbejdsmarkedet. 

## Besvarelse b) {style="font-size: 80%;"}

Med udgangspunkt i beregningen af en d√∏delighedstabel kan man beregne den forventede restlevetid p√• arbejdsmarkedet svarende til den forventede restlevetid i en d√∏delighedstabel ved hj√¶lp af f√∏lgende data og antagelser: I en fiktiv befolkning antages det f√∏rst, at alle tr√¶der ind p√• arbejdsmarkedet samtidig, og at ingen forlader arbejdsmarkedet i kortere perioder f√∏r deres endelige exit. Man skal have data om, hvor mange der forlader arbejdsmarkedet i hvert alderstrin eller aldersinterval i en given periode i en faktisk befolkning. Kun personer, der definitivt har forladt arbejdsmarkedet, b√∏r medtages. Der m√• derfor g√∏res antagelser om, hvorn√•r en person kan siges at have forladt arbejdsmarkedet uden hensigt om at vende tilbage, eventuelt baseret p√• oplysninger om tilbagevenden til arbejdsmarkedet eller √•rsagen til exit. Endelig m√• man antage, hvorn√•r i l√∏bet af √•ret eller i et aldersinterval en person forlader arbejdsmarkedet, det vil sige, man skal definere Chiangs a for hvert alderstrin eller aldersinterval.